{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"children\"];\nimport { useEffect, useState } from 'react';\nimport React, { useContext } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport useStyles from \"./changeAvatar.module\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport PlusSvg from \"../../../assets/icons/plusSvg\";\nimport CameraSvg from \"../../../assets/icons/cameraSvg\";\nimport * as ImagePicker from 'expo-image-picker';\nimport { ImageContext } from \"../../../context/ImageContext\";\nimport AuthContext from \"../../../context/AuthContext\";\nimport axios from 'axios';\nimport ImageViewer from \"../../ImageViewer/ImageViewer\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function ChangeAvatar(_ref) {\n  var children = _ref.children,\n    data = _objectWithoutProperties(_ref, _excluded);\n  var _useContext = useContext(ImageContext),\n    updateSelectedImage = _useContext.updateSelectedImage;\n  var styles = useStyles();\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    permission = _useState2[0],\n    setRequestPermission = _useState2[1];\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    selectedImage = _useState4[0],\n    setSelectedImage = _useState4[1];\n  var _useState5 = useState(false),\n    _useState6 = _slicedToArray(_useState5, 2),\n    isHovered = _useState6[0],\n    setIsHovered = _useState6[1];\n  var _useContext2 = useContext(AuthContext),\n    user = _useContext2.user,\n    updateUser = _useContext2.updateUser;\n  var username = 'admin';\n  var password = 'root';\n  var base64Image = \"data:image/jpeg;base64,\" + user.image;\n  useEffect(function () {\n    _asyncToGenerator(function* () {\n      var cameraStatus = yield ImagePicker.requestMediaLibraryPermissionsAsync();\n      setRequestPermission(cameraStatus.status === 'granted');\n    })();\n  });\n  var handleMouseEnter = function handleMouseEnter() {\n    setIsHovered(true);\n  };\n  var handleMouseLeave = function handleMouseLeave() {\n    setIsHovered(false);\n  };\n  var pickImageAsync = function () {\n    var _ref3 = _asyncToGenerator(function* () {\n      var result = yield ImagePicker.launchImageLibraryAsync({\n        allowsEditing: true,\n        quality: 1\n      });\n      if (!result.canceled) {\n        uploadImage(result);\n      } else {}\n    });\n    return function pickImageAsync() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var uploadImage = function () {\n    var _ref4 = _asyncToGenerator(function* (imageAsset) {\n      var formData = new FormData();\n      var response = yield fetch(imageAsset.uri);\n      var blob = yield response.blob();\n      formData.append('file', blob, 'file.jpg');\n      var userId = user == null ? void 0 : user.id;\n      var apiUrl = \"https://linking-api.onrender.com/api/users/\" + userId + \"/update/image\";\n      try {\n        var _response = yield axios.put(apiUrl, formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data',\n            Authorization: \"Basic \" + btoa(username + \":\" + password)\n          }\n        });\n        if (_response.status === 200 || _response.status === 201) {\n          setSelectedImage(imageAsset.uri);\n          updateSelectedImage(imageAsset.uri);\n        }\n      } catch (error) {\n        if (error.response && error.response.data && error.response.data.message) {\n          alert('Ошибка ' + error.response.data.message);\n        }\n      }\n    });\n    return function uploadImage(_x) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  var openCamera = function () {\n    var _ref5 = _asyncToGenerator(function* () {\n      var permissionResult = yield ImagePicker.requestCameraPermissionsAsync();\n      if (permissionResult.granted === false) {\n        return;\n      }\n      var result = yield ImagePicker.launchCameraAsync();\n      if (!result.canceled) {\n        setSelectedImage(result.assets[0].uri);\n        uploadImage(result.assets[0]);\n      }\n    });\n    return function openCamera() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  return _jsx(View, {\n    style: styles.container,\n    children: _jsxs(View, {\n      style: styles.round,\n      children: [_jsxs(TouchableOpacity, {\n        onPress: pickImageAsync,\n        onMouseEnter: handleMouseEnter,\n        onMouseLeave: handleMouseLeave,\n        children: [!user.image && _jsx(View, {\n          style: styles.nonePhoto,\n          children: isHovered ? _jsx(PlusSvg, {}) : null\n        }), user.image && _jsx(View, {\n          children: isHovered ? _jsx(View, {\n            style: [styles.nonePhoto, styles.hovered],\n            children: _jsx(PlusSvg, {})\n          }) : _jsx(ImageViewer, {\n            style: styles.image,\n            isAvatar: true,\n            selectedImage: base64Image\n          })\n        })]\n      }), _jsx(View, {\n        style: {\n          position: 'absolute',\n          bottom: 0,\n          right: 0\n        },\n        children: _jsx(TouchableOpacity, {\n          onPress: openCamera,\n          children: _jsx(CameraSvg, {})\n        })\n      })]\n    })\n  });\n}","map":{"version":3,"names":["useEffect","useState","React","useContext","View","useStyles","TouchableOpacity","PlusSvg","CameraSvg","ImagePicker","ImageContext","AuthContext","axios","ImageViewer","jsx","_jsx","jsxs","_jsxs","ChangeAvatar","_ref","children","data","_objectWithoutProperties","_excluded","_useContext","updateSelectedImage","styles","_useState","_useState2","_slicedToArray","permission","setRequestPermission","_useState3","_useState4","selectedImage","setSelectedImage","_useState5","_useState6","isHovered","setIsHovered","_useContext2","user","updateUser","username","password","base64Image","image","_asyncToGenerator","cameraStatus","requestMediaLibraryPermissionsAsync","status","handleMouseEnter","handleMouseLeave","pickImageAsync","_ref3","result","launchImageLibraryAsync","allowsEditing","quality","canceled","uploadImage","apply","arguments","_ref4","imageAsset","formData","FormData","response","fetch","uri","blob","append","userId","id","apiUrl","put","headers","Authorization","btoa","error","message","alert","_x","openCamera","_ref5","permissionResult","requestCameraPermissionsAsync","granted","launchCameraAsync","assets","style","container","round","onPress","onMouseEnter","onMouseLeave","nonePhoto","hovered","isAvatar","position","bottom","right"],"sources":["C:/Users/ilias/OneDrive/Рабочий стол/messenger_project/Application/Client/components/Avatar/ChangeAvatar/changeAvatar.js"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport React, { useContext } from 'react';\r\nimport { View } from 'react-native-web';\r\nimport useStyles from './changeAvatar.module';\r\nimport { TouchableOpacity } from 'react-native-web';\r\nimport PlusSvg from '../../../assets/icons/plusSvg';\r\nimport CameraSvg from '../../../assets/icons/cameraSvg';\r\nimport * as ImagePicker from 'expo-image-picker';\r\nimport { ImageContext } from '../../../context/ImageContext';\r\nimport AuthContext from '../../../context/AuthContext';\r\nimport axios from 'axios';\r\nimport ImageViewer from \"../../ImageViewer/ImageViewer\";\r\n\r\nexport default function ChangeAvatar({ children, ...data }) {\r\n  const { updateSelectedImage } = useContext(ImageContext);\r\n  const styles = useStyles();\r\n  const [permission, setRequestPermission] = useState(null);\r\n  const [selectedImage, setSelectedImage] = useState(null);\r\n  const [isHovered, setIsHovered] = useState(false); // New state for hover tracking\r\n  const { user, updateUser } = useContext(AuthContext);\r\n  const username = 'admin';\r\n  const password = 'root';\r\n  const base64Image = `data:image/jpeg;base64,${user.image}`;\r\n  useEffect(() => {\r\n    (async () => {\r\n      const cameraStatus = await ImagePicker.requestMediaLibraryPermissionsAsync();\r\n      setRequestPermission(cameraStatus.status === 'granted');\r\n    })();\r\n  });\r\n\r\n  const handleMouseEnter = () => {\r\n    setIsHovered(true);\r\n  };\r\n\r\n  const handleMouseLeave = () => {\r\n    setIsHovered(false);\r\n  };\r\n\r\n  const pickImageAsync = async () => {\r\n    let result = await ImagePicker.launchImageLibraryAsync({\r\n      allowsEditing: true,\r\n      quality: 1,\r\n    });\r\n\r\n    if (!result.canceled) {\r\n      uploadImage(result);\r\n    } else {\r\n    }\r\n  };\r\n\r\n  const uploadImage = async (imageAsset) => {\r\n    const formData = new FormData();\r\n    const response = await fetch(imageAsset.uri);\r\n    const blob = await response.blob();\r\n\r\n    formData.append('file', blob, 'file.jpg');\r\n\r\n    const userId = user?.id;\r\n    const apiUrl = `https://linking-api.onrender.com/api/users/${userId}/update/image`;\r\n\r\n    try {\r\n      const response = await axios.put(apiUrl, formData, {\r\n        headers: {\r\n          'Content-Type': 'multipart/form-data',\r\n          Authorization: `Basic ${btoa(`${username}:${password}`)}`,\r\n        },\r\n      });\r\n\r\n      if (response.status === 200 || response.status === 201) {\r\n        setSelectedImage(imageAsset.uri);\r\n        updateSelectedImage(imageAsset.uri);\r\n      }\r\n    } catch (error) {\r\n      if (error.response && error.response.data && error.response.data.message) {\r\n        alert('Ошибка ' + error.response.data.message);\r\n      }\r\n    }\r\n  };\r\n\r\n  const openCamera = async () => {\r\n    const permissionResult = await ImagePicker.requestCameraPermissionsAsync();\r\n\r\n    if (permissionResult.granted === false) {\r\n      return;\r\n    }\r\n\r\n    const result = await ImagePicker.launchCameraAsync();\r\n\r\n    if (!result.canceled) {\r\n      setSelectedImage(result.assets[0].uri);\r\n      uploadImage(result.assets[0]);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <View style={styles.round}>\r\n        <TouchableOpacity\r\n          onPress={pickImageAsync}\r\n          onMouseEnter={handleMouseEnter}\r\n          onMouseLeave={handleMouseLeave}\r\n        >\r\n          {!user.image && (\r\n            <View style={styles.nonePhoto}>\r\n              {isHovered ? <PlusSvg /> : null}\r\n            </View>\r\n          )}\r\n          {user.image && (\r\n            <View>\r\n              {isHovered ? (\r\n                <View style={[styles.nonePhoto, styles.hovered]}>\r\n                  <PlusSvg />\r\n                </View>\r\n              ) : (\r\n                <ImageViewer style={styles.image} isAvatar={true} selectedImage={base64Image} />\r\n              )}\r\n            </View>\r\n          )}\r\n        </TouchableOpacity>\r\n        <View style={{ position: 'absolute', bottom: 0, right: 0 }}>\r\n          <TouchableOpacity onPress={openCamera}>\r\n            <CameraSvg />\r\n          </TouchableOpacity>\r\n        </View>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import React,{useState,useEffect,useRef}from'react';import View from\"react-native-web/dist/exports/View\";import Text from\"react-native-web/dist/exports/Text\";import TouchableHighlight from\"react-native-web/dist/exports/TouchableHighlight\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import CreateSvg from\"../assets/icons/createSvg\";import useStyles from\"./styles/mainAuthScreen.module\";import{useFocusEffect}from'@react-navigation/native';import HeaderButton from\"../components/buttons/headerButton\";import MessageBody from\"../components/messageBody/messageBody\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function ChannelUnauthScreen(_ref){var _channelData$messages2;var navigation=_ref.navigation,route=_ref.route;var styles=useStyles();var channelId=route.params.channelId;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),shouldUseFocusEffect=_useState2[0],setShouldUseFocusEffect=_useState2[1];useEffect(function(){setShouldUseFocusEffect(false);},[channelId]);useFocusEffect(React.useCallback(function(){fetchChannelData();},[channelId]));var username='admin';var password='root';var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),channelData=_useState4[0],setChannelData=_useState4[1];var scrollViewRef=useRef(null);var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),isAtBottom=_useState6[0],setIsAtBottom=_useState6[1];useEffect(function(){var _channelData$messages;if((channelData==null?void 0:(_channelData$messages=channelData.messages)==null?void 0:_channelData$messages.length)>0&&isAtBottom){scrollViewRef.current.scrollToEnd({animated:true});}},[channelData==null?void 0:channelData.messages,isAtBottom]);var handleContentSizeChange=function handleContentSizeChange(){var isScrolledToBottom=scrollViewRef.current&&scrollViewRef.current.contentOffset&&scrollViewRef.current.contentOffset.y+scrollViewRef.current.layoutMeasurement.height>=scrollViewRef.current.contentSize.height;setIsAtBottom(isScrolledToBottom);};var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),channelText=_useState8[0],setChannelText=_useState8[1];var fetchChannelData=function(){var _ref2=_asyncToGenerator(function*(){try{var response=yield fetch(\"https://linking-api.onrender.com/api/channels/\"+channelId,{method:'GET',headers:{'Content-Type':'application/json','Authorization':\"Basic \"+btoa(username+\":\"+password)}});if(response.ok){var _channelData=yield response.json();setChannelData(_channelData);setChannelText(_channelData.channel.name);}else{alert('Не удалось получить данные о канале, возможно он больше не существует');}}catch(error){alert('Ошибка при подключении к серверу:',error);}});return function fetchChannelData(){return _ref2.apply(this,arguments);};}();if(!channelData){return null;}return _jsxs(View,{style:styles.containerMain,children:[_jsxs(View,{style:styles.barChanContainer,children:[_jsx(Text,{style:styles.barText,children:channelText}),_jsx(View,{children:_jsx(HeaderButton,{title:'Присоединиться',onPress:function onPress(){return navigation.navigate('Auth');}})})]}),_jsx(View,{style:styles.historyContainer,children:_jsx(ScrollView,{ref:scrollViewRef,onContentSizeChange:handleContentSizeChange,style:{flex:1,scrollbarWidth:0,flexDirection:'column'},children:channelData==null?void 0:(_channelData$messages2=channelData.messages)==null?void 0:_channelData$messages2.map(function(message){var _message$sender,_matchingMember$role,_message$sender2,_message$sender3;var senderId=(_message$sender=message.sender)==null?void 0:_message$sender.id;var matchingMember=channelData.members.find(function(member){return member.user.id===senderId;});var role=matchingMember==null?void 0:(_matchingMember$role=matchingMember.role)==null?void 0:_matchingMember$role.name;return _jsx(MessageBody,{data:{imageUrl:(_message$sender2=message.sender)==null?void 0:_message$sender2.image,nickname:(_message$sender3=message.sender)==null?void 0:_message$sender3.name,role:role,message:message.data,date:message.date,own:false,channel:true,unauth:true}},message.id);})})}),_jsx(View,{style:styles.bottomLeft,children:_jsx(TouchableHighlight,{onPress:function onPress(){return navigation.navigate('Auth');},children:_jsx(CreateSvg,{})})})]});}","map":{"version":3,"names":["React","useState","useEffect","useRef","View","Text","TouchableHighlight","ScrollView","CreateSvg","useStyles","useFocusEffect","HeaderButton","MessageBody","jsx","_jsx","jsxs","_jsxs","ChannelUnauthScreen","_ref","_channelData$messages2","navigation","route","styles","channelId","params","_useState","_useState2","_slicedToArray","shouldUseFocusEffect","setShouldUseFocusEffect","useCallback","fetchChannelData","username","password","_useState3","_useState4","channelData","setChannelData","scrollViewRef","_useState5","_useState6","isAtBottom","setIsAtBottom","_channelData$messages","messages","length","current","scrollToEnd","animated","handleContentSizeChange","isScrolledToBottom","contentOffset","y","layoutMeasurement","height","contentSize","_useState7","_useState8","channelText","setChannelText","_ref2","_asyncToGenerator","response","fetch","method","headers","btoa","ok","json","channel","name","alert","error","apply","arguments","style","containerMain","children","barChanContainer","barText","title","onPress","navigate","historyContainer","ref","onContentSizeChange","flex","scrollbarWidth","flexDirection","map","message","_message$sender","_matchingMember$role","_message$sender2","_message$sender3","senderId","sender","id","matchingMember","members","find","member","user","role","data","imageUrl","image","nickname","date","own","unauth","bottomLeft"],"sources":["C:/Users/ilias/OneDrive/Рабочий стол/messenger_project/Application/Client/screens/ChannelUnauthScreen.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { View, Text, TouchableHighlight, ScrollView } from 'react-native-web';\r\nimport CreateSvg from '../assets/icons/createSvg';\r\nimport useStyles from './styles/mainAuthScreen.module';\r\nimport { useFocusEffect } from '@react-navigation/native';\r\nimport HeaderButton from '../components/buttons/headerButton';\r\nimport MessageBody from '../components/messageBody/messageBody';\r\n\r\n\r\n\r\nexport default function ChannelUnauthScreen({ navigation, route }) {\r\n    const styles = useStyles();\r\n    const { channelId } = route.params;\r\n    const [shouldUseFocusEffect, setShouldUseFocusEffect] = useState(false);\r\n    \r\n    useEffect(() => {\r\n        setShouldUseFocusEffect(false);\r\n    }, [channelId]);\r\n    useFocusEffect(\r\n        React.useCallback(() => {\r\n            fetchChannelData();\r\n        }, [channelId])\r\n    );\r\n    const username = 'admin';\r\n    const password = 'root';\r\n    const [channelData, setChannelData] = useState([]);\r\n\r\n    const scrollViewRef = useRef(null);\r\n    const [isAtBottom, setIsAtBottom] = useState(true);\r\n\r\n    useEffect(() => {\r\n        if (channelData?.messages?.length > 0 && isAtBottom) {\r\n            scrollViewRef.current.scrollToEnd({ animated: true });\r\n        }\r\n    }, [channelData?.messages, isAtBottom]);\r\n\r\n    const handleContentSizeChange = () => {\r\n        const isScrolledToBottom =\r\n            scrollViewRef.current &&\r\n            scrollViewRef.current.contentOffset &&\r\n            scrollViewRef.current.contentOffset.y + scrollViewRef.current.layoutMeasurement.height >=\r\n            scrollViewRef.current.contentSize.height;\r\n\r\n        setIsAtBottom(isScrolledToBottom);\r\n    };\r\n    const [channelText, setChannelText] = useState('');\r\n    const fetchChannelData = async () => {\r\n        try {\r\n            const response = await fetch(`https://linking-api.onrender.com/api/channels/${channelId}`, {\r\n                method: 'GET',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Basic ${btoa(`${username}:${password}`)}`,\r\n                },\r\n            });\r\n\r\n            if (response.ok) {\r\n                const channelData = await response.json();\r\n\r\n                setChannelData(channelData);\r\n                setChannelText(channelData.channel.name)\r\n            } else {\r\n                alert('Не удалось получить данные о канале, возможно он больше не существует');\r\n            }\r\n        } catch (error) {\r\n            alert('Ошибка при подключении к серверу:', error);\r\n        }\r\n    };\r\n\r\n    if (!channelData) {\r\n        return null; \r\n      }\r\n    return (\r\n        <View style={styles.containerMain}>\r\n            <View style={styles.barChanContainer}>\r\n                <Text style={styles.barText}>{channelText}</Text>\r\n                <View>\r\n                    <HeaderButton title={'Присоединиться'} onPress={() => navigation.navigate('Auth')} />\r\n                </View>\r\n            </View >\r\n            <View style={styles.historyContainer}>\r\n                <ScrollView ref={scrollViewRef} onContentSizeChange={handleContentSizeChange} style={{ flex: 1, scrollbarWidth: 0, flexDirection: 'column' }}>\r\n                {channelData?.messages?.map((message) => {\r\n                        const senderId = message.sender?.id;\r\n                        const matchingMember = channelData.members.find((member) => member.user.id === senderId);\r\n\r\n                        const role = matchingMember?.role?.name;\r\n\r\n                        return (\r\n                            <MessageBody\r\n                                key={message.id}\r\n                                data={{\r\n                                    imageUrl: message.sender?.image,\r\n                                    nickname: message.sender?.name,\r\n                                    role: role,\r\n                                    message: message.data,\r\n                                    date: message.date,\r\n                                    own: false,\r\n                                    channel: true,\r\n                                    unauth: true\r\n                                }}\r\n                              \r\n                            />\r\n                        );\r\n                    })}\r\n                </ScrollView>\r\n\r\n            </View>\r\n            <View style = {styles.bottomLeft}>\r\n             <TouchableHighlight onPress={() => navigation.navigate('Auth')}>\r\n          <CreateSvg />\r\n        </TouchableHighlight>\r\n        </View>\r\n        </View>\r\n    );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
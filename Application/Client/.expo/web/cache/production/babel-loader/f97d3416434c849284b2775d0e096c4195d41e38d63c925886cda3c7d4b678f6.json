{"ast":null,"code":"import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import _objectWithoutProperties from\"@babel/runtime/helpers/objectWithoutProperties\";var _excluded=[\"children\"];import{useEffect,useState}from'react';import React,{useContext}from'react';import View from\"react-native-web/dist/exports/View\";import useStyles from\"./changeAvatar.module\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import PlusSvg from\"../../../assets/icons/plusSvg\";import CameraSvg from\"../../../assets/icons/cameraSvg\";import*as ImagePicker from'expo-image-picker';import{ImageContext}from\"../../../context/ImageContext\";import AuthContext from\"../../../context/AuthContext\";import axios from'axios';import ImageViewer from\"../../ImageViewer/ImageViewer\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function ChangeAvatar(_ref){var children=_ref.children,data=_objectWithoutProperties(_ref,_excluded);var _useContext=useContext(ImageContext),updateSelectedImage=_useContext.updateSelectedImage;var styles=useStyles();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),permission=_useState2[0],setRequestPermission=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),selectedImage=_useState4[0],setSelectedImage=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isHovered=_useState6[0],setIsHovered=_useState6[1];var _useContext2=useContext(AuthContext),user=_useContext2.user,updateUser=_useContext2.updateUser;var username='admin';var password='root';var base64Image=\"data:image/jpeg;base64,\"+user.image;useEffect(function(){_asyncToGenerator(function*(){var cameraStatus=yield ImagePicker.requestMediaLibraryPermissionsAsync();setRequestPermission(cameraStatus.status==='granted');})();});var handleMouseEnter=function handleMouseEnter(){setIsHovered(true);};var handleMouseLeave=function handleMouseLeave(){setIsHovered(false);};var pickImageAsync=function(){var _ref3=_asyncToGenerator(function*(){var result=yield ImagePicker.launchImageLibraryAsync({allowsEditing:true,quality:1});if(!result.canceled){uploadImage(result);}else{}});return function pickImageAsync(){return _ref3.apply(this,arguments);};}();var uploadImage=function(){var _ref4=_asyncToGenerator(function*(imageAsset){var formData=new FormData();var response=yield fetch(imageAsset.uri);var blob=yield response.blob();formData.append('file',blob,'file.jpg');var userId=user==null?void 0:user.id;var apiUrl=\"https://linking-api.onrender.com/api/users/\"+userId+\"/update/image\";try{var _response=yield axios.put(apiUrl,formData,{headers:{'Content-Type':'multipart/form-data',Authorization:\"Basic \"+btoa(username+\":\"+password)}});if(_response.status===200||_response.status===201){setSelectedImage(imageAsset.uri);updateSelectedImage(imageAsset.uri);}}catch(error){if(error.response&&error.response.data&&error.response.data.message){alert('Ошибка '+error.response.data.message);}}});return function uploadImage(_x){return _ref4.apply(this,arguments);};}();var openCamera=function(){var _ref5=_asyncToGenerator(function*(){var permissionResult=yield ImagePicker.requestCameraPermissionsAsync();if(permissionResult.granted===false){return;}var result=yield ImagePicker.launchCameraAsync();if(!result.canceled){setSelectedImage(result.assets[0].uri);uploadImage(result.assets[0]);}});return function openCamera(){return _ref5.apply(this,arguments);};}();return _jsx(View,{style:styles.container,children:_jsxs(View,{style:styles.round,children:[_jsxs(TouchableOpacity,{onPress:pickImageAsync,onMouseEnter:handleMouseEnter,onMouseLeave:handleMouseLeave,children:[!user.image&&_jsx(View,{style:styles.nonePhoto,children:isHovered?_jsx(PlusSvg,{}):null}),user.image&&_jsx(View,{children:isHovered?_jsx(View,{style:styles.nonePhoto,children:_jsx(PlusSvg,{})}):_jsx(ImageViewer,{style:styles.image,isAvatar:true,selectedImage:base64Image})})]}),_jsx(View,{style:{position:'absolute',bottom:0,right:0},children:_jsx(TouchableOpacity,{onPress:openCamera,children:_jsx(CameraSvg,{})})})]})});}","map":{"version":3,"names":["useEffect","useState","React","useContext","View","useStyles","TouchableOpacity","PlusSvg","CameraSvg","ImagePicker","ImageContext","AuthContext","axios","ImageViewer","jsx","_jsx","jsxs","_jsxs","ChangeAvatar","_ref","children","data","_objectWithoutProperties","_excluded","_useContext","updateSelectedImage","styles","_useState","_useState2","_slicedToArray","permission","setRequestPermission","_useState3","_useState4","selectedImage","setSelectedImage","_useState5","_useState6","isHovered","setIsHovered","_useContext2","user","updateUser","username","password","base64Image","image","_asyncToGenerator","cameraStatus","requestMediaLibraryPermissionsAsync","status","handleMouseEnter","handleMouseLeave","pickImageAsync","_ref3","result","launchImageLibraryAsync","allowsEditing","quality","canceled","uploadImage","apply","arguments","_ref4","imageAsset","formData","FormData","response","fetch","uri","blob","append","userId","id","apiUrl","put","headers","Authorization","btoa","error","message","alert","_x","openCamera","_ref5","permissionResult","requestCameraPermissionsAsync","granted","launchCameraAsync","assets","style","container","round","onPress","onMouseEnter","onMouseLeave","nonePhoto","isAvatar","position","bottom","right"],"sources":["C:/Users/ilias/OneDrive/Рабочий стол/messenger_project/Application/Client/components/Avatar/ChangeAvatar/changeAvatar.js"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport React, { useContext } from 'react';\r\nimport { View } from 'react-native-web';\r\nimport useStyles from './changeAvatar.module';\r\nimport { TouchableOpacity } from 'react-native-web';\r\nimport PlusSvg from '../../../assets/icons/plusSvg';\r\nimport CameraSvg from '../../../assets/icons/cameraSvg';\r\nimport * as ImagePicker from 'expo-image-picker';\r\nimport { ImageContext } from '../../../context/ImageContext';\r\nimport AuthContext from '../../../context/AuthContext';\r\nimport axios from 'axios';\r\nimport ImageViewer from \"../../ImageViewer/ImageViewer\";\r\n\r\nexport default function ChangeAvatar({ children, ...data }) {\r\n  const { updateSelectedImage } = useContext(ImageContext);\r\n  const styles = useStyles();\r\n  const [permission, setRequestPermission] = useState(null);\r\n  const [selectedImage, setSelectedImage] = useState(null);\r\n  const [isHovered, setIsHovered] = useState(false); // New state for hover tracking\r\n  const { user, updateUser } = useContext(AuthContext);\r\n  const username = 'admin';\r\n  const password = 'root';\r\n  const base64Image = `data:image/jpeg;base64,${user.image}`;\r\n  useEffect(() => {\r\n    (async () => {\r\n      const cameraStatus = await ImagePicker.requestMediaLibraryPermissionsAsync();\r\n      setRequestPermission(cameraStatus.status === 'granted');\r\n    })();\r\n  });\r\n\r\n  const handleMouseEnter = () => {\r\n    setIsHovered(true);\r\n  };\r\n\r\n  const handleMouseLeave = () => {\r\n    setIsHovered(false);\r\n  };\r\n\r\n  const pickImageAsync = async () => {\r\n    let result = await ImagePicker.launchImageLibraryAsync({\r\n      allowsEditing: true,\r\n      quality: 1,\r\n    });\r\n\r\n    if (!result.canceled) {\r\n      uploadImage(result);\r\n    } else {\r\n    }\r\n  };\r\n\r\n  const uploadImage = async (imageAsset) => {\r\n    const formData = new FormData();\r\n    const response = await fetch(imageAsset.uri);\r\n    const blob = await response.blob();\r\n\r\n    formData.append('file', blob, 'file.jpg');\r\n\r\n    const userId = user?.id;\r\n    const apiUrl = `https://linking-api.onrender.com/api/users/${userId}/update/image`;\r\n\r\n    try {\r\n      const response = await axios.put(apiUrl, formData, {\r\n        headers: {\r\n          'Content-Type': 'multipart/form-data',\r\n          Authorization: `Basic ${btoa(`${username}:${password}`)}`,\r\n        },\r\n      });\r\n\r\n      if (response.status === 200 || response.status === 201) {\r\n        setSelectedImage(imageAsset.uri);\r\n        updateSelectedImage(imageAsset.uri);\r\n      }\r\n    } catch (error) {\r\n      if (error.response && error.response.data && error.response.data.message) {\r\n        alert('Ошибка ' + error.response.data.message);\r\n      }\r\n    }\r\n  };\r\n\r\n  const openCamera = async () => {\r\n    const permissionResult = await ImagePicker.requestCameraPermissionsAsync();\r\n\r\n    if (permissionResult.granted === false) {\r\n      return;\r\n    }\r\n\r\n    const result = await ImagePicker.launchCameraAsync();\r\n\r\n    if (!result.canceled) {\r\n      setSelectedImage(result.assets[0].uri);\r\n      uploadImage(result.assets[0]);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <View style={styles.round}>\r\n        <TouchableOpacity\r\n          onPress={pickImageAsync}\r\n          onMouseEnter={handleMouseEnter}\r\n          onMouseLeave={handleMouseLeave}\r\n        >\r\n          {!user.image && (\r\n            <View style={styles.nonePhoto}>\r\n              {isHovered ? <PlusSvg /> : null}\r\n            </View>\r\n          )}\r\n          {user.image && (\r\n            <View>\r\n              {isHovered ? (\r\n                <View style={styles.nonePhoto}>\r\n                  <PlusSvg />\r\n                </View>\r\n              ) : (\r\n                <ImageViewer style = {styles.image} isAvatar={true} selectedImage={base64Image} />\r\n              )}\r\n            </View>\r\n          )}\r\n        </TouchableOpacity>\r\n        <View style={{ position: 'absolute', bottom: 0, right: 0 }}>\r\n          <TouchableOpacity onPress={openCamera}>\r\n            <CameraSvg />\r\n          </TouchableOpacity>\r\n        </View>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}